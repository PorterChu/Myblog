## 1. static介绍

&emsp;&emsp;static是C语言的一个关键字，通常一个关键字只有一个含义，也就是一种用法，但static不同，它具有两种含义，且这两种含义相互之间没有任何关联。

- static修饰局部变量
- static修饰全局变量或函数

&emsp;&emsp;在介绍static功能之前，先来了解下内存的管理方法，大致可以划分为栈、堆、数据段、bss段、代码段这五部分。

### 1.1 栈

&emsp;&emsp;栈其实是一种数据结构，C语言用它来存放局部变量(auto修改的变量，通常auto会省略，仅在语句块中使用)。

&emsp;&emsp;以下面例子来说明：假设栈空间大小为32K，栈空间为空时，Top指针和Bottom指针都指向地址0x0000，此时定义一个int型的局部变量a并赋值为4，因为int型变量占4个字节，则数值4就被存储在地址为0x0000 ~ 0x0003所代表的空间中，而Top指针向上移动指向0x0004；同理，再定义一个double型变量b并赋值为8.0000，则地址0x0004 ~ 0x000b所代表的空间存储着变量b的数值8.0000，Top指针继续向上移动到0x000c；在为变量a和变量b分配空间的时候，Top指针会随着空间的分配而移动，Bottom指针一直指向原始地址不变。

&emsp;&emsp;同样的，当释放double型局部变量b时，Top指针向下移动到地址0x0004，数值8.0000存储的空间就被系统释放，此时要记住，原先空间中存储变量b的数值并没有被清空（这就是下面要讲到的脏内存）；最后如果语句块代码执行结束，变量a的空间也会被释放，Top指针最终仍然指向原始地址0x0000。值得注意的是，在此过程中，要想释放变量a的空间就必须先释放变量b的空间，无法跳过变量b先释放变量a，这就像一个储物柜，先放进去的东西只能等到最后才能拿出来，这就是栈很重要的一个特点叫先进后出(FILO)，也可称为后进先出(LIFO)。

![](./image/stack.svg)

从上面流程分析中可以总结如下几点：

- **栈对于局部变量的空间分配是系统来分配的**：当程序员定义一个局部变量时，系统就会为这个变量自动分配一个空间；同理释放栈空间也是由系统自动回收的，无需程序员操作；
- **栈空间是被重复使用的：栈空间由系统分配释放**，所以随着语句块程序的执行和结束，栈空间会不停分配和释放，所以栈空间在代码执行过程中会被重复使用，实际的分配地址空间也是根据Top指针来随机分配的；
- **栈空间是脏内存**：由于栈空间的重复使用，原先空间中存放的数值并没有随着空间的释放而被清理，所以当我们定义一个局部变量时一定要对变量进行初始化，否则变量的值会因为脏内存而产生随机的值，不确定的值会增加程序的风险性；
- **栈空间大小是固定的**：不同于堆空间，栈空间大小是固定的，且容量一般较小，所以在定义布局变量时一般不建议占用较大的空间，容易引发段错误或造成数组溢出；
- **语句块不可返回局部变量或不可作用域外访问局部变量**：局部变量有其自身的作用域，当语句块代码执行结束超出局部变量作用域时，栈空间就被释放，此时从变量作用域外去访问此变量是有风险的，同时当语句块代码执行结束也不可返回此局部变量，因为存放该变量的地址空间已经被释放。

### 1.2 堆

### 1.3 数据段

### 1.4 bss段

### 1.5 代码段

## 2. static修饰局部变量

## 3. static修饰全局变量或函数